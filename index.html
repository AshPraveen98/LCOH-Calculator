<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title style="color:green;">LCOH Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
      background: #f4f4f4;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input {
      margin: 5px;
      padding: 8px;
      width: 120px;
    }
    canvas {
      max-width: 500px;
      max-height: 300px;
    }
    .charts {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="color: green;">Levelized Cost of Hydrogen (LCOH) Dashboard</h2>

    <div>
      <input id="baseCost" placeholder="Base Cost" type="number" />
      <input id="compressorCost" placeholder="Compressor Cost" type="number" />
      <input id="epc" placeholder="EPC Cost" type="number" />
      <input id="building" placeholder="Building Cost" type="number" />
      <input id="stackReplacement" placeholder="Stack Replacement" type="number" />
      <input id="pressure" placeholder="Pressure (bar)" type="number" />
      <input id="compressorEfficiency" placeholder="Efficiency (%)" type="number" />
      <input id="tax" placeholder="Tax (%)" type="number" />
      <input id="subsidy" placeholder="Subsidy" type="number" />
      <select id="currencySelect" onchange="convertCurrency()">
        <option value="INR">₹ INR</option>
        <option value="EUR">€ EUR</option>
      </select>
      <button onclick="calculateLCOH()">Calculate</button>
      <button onclick="downloadCSV()">Download CSV</button>
    </div>

    <h3 id="result">LCOH: ₹0.00 / kg</h3>

    <div class="charts">
      <canvas id="costChart"></canvas>
      <canvas id="pressureChart"></canvas>
    </div>
  </div>

  <script>
    const currencyRates = { INR: 1, EUR: 90 };
    let currentCurrency = 'INR';

    let costChart, pressureChart;

    function calculateLCOH() {
      const base = parseFloat(document.getElementById('baseCost').value) || 0;
      const pressure = parseFloat(document.getElementById('pressure').value) || 0;
      const efficiency = parseFloat(document.getElementById('compressorEfficiency').value) || 100;
      const compressor = parseFloat(document.getElementById('compressorCost').value) || 0;
      const epc = parseFloat(document.getElementById('epc').value) || 0;
      const building = parseFloat(document.getElementById('building').value) || 0;
      const stack = parseFloat(document.getElementById('stackReplacement').value) || 0;
      const tax = parseFloat(document.getElementById('tax').value) || 0;
      const subsidy = parseFloat(document.getElementById('subsidy').value) || 0;

      const pressureFactor = 0.02;
      const pressureCost = pressure * pressureFactor * (100 / efficiency);

      const totalCost = base + compressor + epc + building + stack + pressureCost;
      const taxedCost = totalCost * (1 + tax / 100);
      const finalCost = taxedCost - subsidy;

      const currencySymbol = currentCurrency === 'INR' ? '₹' : '€';
      document.getElementById('result').innerText = `LCOH: ${currencySymbol}${finalCost.toFixed(2)} / kg`;

      updateCharts({
        base,
        compressor,
        epc,
        building,
        stack,
        pressureCost,
        taxedCost,
        subsidy,
        finalCost,
        efficiency
      });
    }

    function updateCharts(data) {
      const ctx1 = document.getElementById('costChart').getContext('2d');
      const ctx2 = document.getElementById('pressureChart').getContext('2d');

      if (costChart) costChart.destroy();
      if (pressureChart) pressureChart.destroy();

      costChart = new Chart(ctx1, {
        type: 'pie',
        data: {
          labels: ['Base', 'Compressor', 'EPC', 'Building', 'Stack', 'Pressure', 'Taxes', 'Subsidy'],
          datasets: [{
            data: [
              data.base,
              data.compressor,
              data.epc,
              data.building,
              data.stack,
              data.pressureCost,
              data.taxedCost - data.finalCost,
              data.subsidy
            ],
            backgroundColor: [
              '#4caf50', '#2196f3', '#ff9800', '#9c27b0',
              '#f44336', '#607d8b', '#8bc34a', '#ffc107'
            ]
          }]
        },
        options: { responsive: true }
      });

      pressureChart = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: Array.from({ length: 11 }, (_, i) => i * 10),
          datasets: [{
            label: 'Pressure vs Cost (₹ or €)',
            data: Array.from({ length: 11 }, (_, i) => i * 10 * 0.02 * (100 / data.efficiency)),
            borderColor: '#3f51b5',
            fill: false
          }]
        },
        options: { responsive: true }
      });
    }

    function convertCurrency() {
      const selected = document.getElementById('currencySelect').value;
      const rate = currencyRates[selected] / currencyRates[currentCurrency];
      ['baseCost', 'compressorCost', 'epc', 'building', 'stackReplacement', 'subsidy'].forEach(id => {
        const el = document.getElementById(id);
        el.value = (parseFloat(el.value) * rate).toFixed(2);
      });
      currentCurrency = selected;
      calculateLCOH();
    }

    function downloadCSV() {
      const rows = [
        ['Base Cost', document.getElementById('baseCost').value],
        ['Compressor Cost', document.getElementById('compressorCost').value],
        ['EPC', document.getElementById('epc').value],
        ['Building', document.getElementById('building').value],
        ['Stack Replacement', document.getElementById('stackReplacement').value],
        ['Pressure (bar)', document.getElementById('pressure').value],
        ['Efficiency (%)', document.getElementById('compressorEfficiency').value],
        ['Tax (%)', document.getElementById('tax').value],
        ['Subsidy', document.getElementById('subsidy').value],
        ['Final LCOH', document.getElementById('result').innerText]
      ];

      const csvContent = 'data:text/csv;charset=utf-8,' + rows.map(e => e.join(',')).join('\n');
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', 'lcoh_calculation.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    calculateLCOH();
  </script>
</body>
</html>
