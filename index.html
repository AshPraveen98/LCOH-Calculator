<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title style="color: green;">LCOH Calculator Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #e0f7fa, #ffffff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 95%;
      max-width: 1400px;
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      text-align: center;
    }
    h2 {
      color: green;
      font-size: 2em;
    }
    .field {
      margin-bottom: 15px;
    }
    .field label {
      display: block;
      font-weight: bold;
      color: #333;
    }
    .field input, .field select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #bbb;
      border-radius: 8px;
      font-size: 1em;
    }
    .currency-toggle {
      margin-bottom: 20px;
    }
    #result {
      margin-top: 20px;
      font-size: 1.8em;
      text-align: center;
      font-weight: bold;
      color: #2e7d32;
    }
    .output-box {
      background: #f1f8e9;
      padding: 20px;
      border-radius: 15px;
      margin-top: 30px;
      box-shadow: inset 0 0 5px #c8e6c9;
    }
    button {
      background-color: #43a047;
      color: white;
      padding: 12px 24px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #2e7d32;
    }
    .chart-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      margin-top: 30px;
    }
    canvas {
      max-width: 500px;
      width: 100%;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>LCOH Calculator - Indian System</h2>
    <div class="currency-toggle">
      <label>
        Currency:
        <select id="currencySelect" onchange="convertCurrency(); calculateLCOH();">
          <option value="INR">INR (₹)</option>
          <option value="EUR">EUR (€)</option>
        </select>
      </label>
    </div>

    <div class="field">
      <label for="baseCost">Base Cost per kg (₹ or €)</label>
      <input type="number" id="baseCost" value="300" oninput="calculateLCOH()" />
    </div>

    <div class="field">
      <label for="pressure">Hydrogen Pressure (bar)</label>
      <input type="number" id="pressure" value="30" oninput="calculateLCOH()" />
    </div>

    <div class="field">
      <label for="compressorEfficiency">Compressor Efficiency (%)</label>
      <input type="number" id="compressorEfficiency" value="85" oninput="calculateLCOH()" />
    </div>

    <div class="field">
      <label for="tax">Taxes (%)</label>
      <input type="number" id="tax" value="5" oninput="calculateLCOH()" />
    </div>
    <div class="field">
      <label for="subsidy">Subsidy (₹ or €)</label>
      <input type="number" id="subsidy" value="20" oninput="calculateLCOH()" />
    </div>

    <div class="output-box" id="result"></div>

    <div class="chart-container">
      <canvas id="costChart"></canvas>
      <canvas id="pressureChart"></canvas>
    </div>

    <script>
      let currentCurrency = 'INR';
      const conversionRate = 0.011;

      function convertCurrency() {
        const selected = document.getElementById('currencySelect').value;
        const inputs = document.querySelectorAll('input[type="number"]');

        if (selected !== currentCurrency) {
          inputs.forEach(input => {
            const value = parseFloat(input.value);
            if (!isNaN(value)) {
              input.value = selected === 'EUR' ? (value * conversionRate).toFixed(2) : (value / conversionRate).toFixed(2);
            }
          });
          currentCurrency = selected;
          updateLabels();
        }
      }

      function updateLabels() {
        const symbol = currentCurrency === 'INR' ? '₹' : '€';
        const labels = document.querySelectorAll('label');
        labels.forEach(label => {
          label.innerHTML = label.innerHTML.replace(/₹|€/g, symbol);
        });
      }

      function calculateLCOH() {
        const baseCost = parseFloat(document.getElementById('baseCost').value) || 0;
        const pressure = parseFloat(document.getElementById('pressure').value) || 0;
        const taxPercent = parseFloat(document.getElementById('tax').value) || 0;
        const subsidy = parseFloat(document.getElementById('subsidy').value) || 0;
        const compressorEfficiency = parseFloat(document.getElementById('compressorEfficiency').value) || 100;

        let pressureCost = 0;
        if (pressure > 30) {
          if (pressure <= 100) {
            pressureCost = Math.log(pressure / 30) * (100 / compressorEfficiency);
          } else {
            pressureCost = Math.log(pressure / 100) * (150 / compressorEfficiency) + Math.log(100 / 30) * (100 / compressorEfficiency);
          }
        }

        const taxAmount = (taxPercent / 100) * (baseCost + pressureCost);
        const finalCost = baseCost + pressureCost + taxAmount - subsidy;

        const currencySymbol = currentCurrency === 'INR' ? '₹' : '€';
        document.getElementById('result').innerText = `Final LCOH: ${currencySymbol}${finalCost.toFixed(2)} per kg`;

        drawPieChart([baseCost, pressureCost, taxAmount, -subsidy], ['Base Cost', 'Pressure Cost', 'Tax', 'Subsidy']);
        drawPressureChart();
      }

      function drawPieChart(data, labels) {
        const ctx = document.getElementById('costChart').getContext('2d');
        if (window.costChartInstance) window.costChartInstance.destroy();
        window.costChartInstance = new Chart(ctx, {
          type: 'pie',
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: ['#4caf50', '#9c27b0', '#ff9800', '#03a9f4']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return `${context.label}: ${currentCurrency === 'INR' ? '₹' : '€'}${context.parsed.toFixed(2)}`;
                  }
                }
              }
            }
          }
        });
      }

      function drawPressureChart() {
        const ctx = document.getElementById('pressureChart').getContext('2d');
        if (window.pressureChartInstance) window.pressureChartInstance.destroy();

        const compressorEfficiency = parseFloat(document.getElementById('compressorEfficiency').value) || 100;
        const pressures = Array.from({ length: 171 }, (_, i) => i + 30); // 30 to 200 bar
        const costs = pressures.map(p => {
          if (p > 30 && p <= 100) {
            return Math.log(p / 30) * (100 / compressorEfficiency);
          } else if (p > 100) {
            return Math.log(p / 100) * (150 / compressorEfficiency) + Math.log(100 / 30) * (100 / compressorEfficiency);
          }
          return 0;
        });

        window.pressureChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: pressures,
            datasets: [{
              label: 'Pressure-based Cost (₹ or €)',
              data: costs,
              fill: false,
              borderColor: '#ff5722',
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Pressure (bar)'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Cost'
                }
              }
            }
          }
        });
      }

      window.onload = () => {
        calculateLCOH();
      };
    </script>
  </div>
</body>
</html>
